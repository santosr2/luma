[tool.bumpversion]
current_version = "0.1.0-rc.9"
parse = "(?P<major>\\d+)\\.(?P<minor>\\d+)\\.(?P<patch>\\d+)(\\-(?P<pre>[a-z]+)\\.?(?P<pre_n>\\d+)?)?"
serialize = [
    "{major}.{minor}.{patch}-{pre}.{pre_n}",
    "{major}.{minor}.{patch}"
]
search = "{current_version}"
replace = "{new_version}"
regex = false
ignore_missing_version = false
tag = true
sign_tags = false
tag_name = "v{new_version}"
tag_message = "Bump version: {current_version} → {new_version}"
allow_dirty = false
commit = true
message = "chore: bump version {current_version} → {new_version}"
commit_args = "--signoff --no-gpg-sign"

[tool.bumpversion.parts.pre]
optional_value = ""
values = ["", "alpha", "beta", "rc"]

[tool.bumpversion.parts.pre_n]
optional_value = ""

# Core Lua version file
[[tool.bumpversion.files]]
filename = "luma/version.lua"
search = "major = {current_major}"
replace = "major = {new_major}"

[[tool.bumpversion.files]]
filename = "luma/version.lua"
search = "minor = {current_minor}"
replace = "minor = {new_minor}"

[[tool.bumpversion.files]]
filename = "luma/version.lua"
search = "patch = {current_patch}"
replace = "patch = {new_patch}"

[[tool.bumpversion.files]]
filename = "luma/version.lua"
search = "pre = \"{current_pre}.{current_pre_n}\""
replace = "pre = \"{new_pre}.{new_pre_n}\""
regex = false

# Python bindings
[[tool.bumpversion.files]]
filename = "bindings/python/pyproject.toml"
search = "version = \"{current_version}\""
replace = "version = \"{new_version}\""

[[tool.bumpversion.files]]
filename = "bindings/python/luma/__init__.py"
search = "__version__ = \"{current_version}\""
replace = "__version__ = \"{new_version}\""

# Node.js bindings
[[tool.bumpversion.files]]
filename = "bindings/nodejs/package.json"
search = "\"version\": \"{current_version}\""
replace = "\"version\": \"{new_version}\""

# Note: package-lock.json is auto-generated by npm, no need to version bump it

# Go bindings - embedded Lua version
[[tool.bumpversion.files]]
filename = "bindings/go/lua/luma/version.lua"
search = "major = {current_major}"
replace = "major = {new_major}"

[[tool.bumpversion.files]]
filename = "bindings/go/lua/luma/version.lua"
search = "minor = {current_minor}"
replace = "minor = {new_minor}"

[[tool.bumpversion.files]]
filename = "bindings/go/lua/luma/version.lua"
search = "patch = {current_patch}"
replace = "patch = {new_patch}"

[[tool.bumpversion.files]]
filename = "bindings/go/lua/luma/version.lua"
search = "pre = \"{current_pre}.{current_pre_n}\""
replace = "pre = \"{new_pre}.{new_pre_n}\""
regex = false

# Node.js bindings - embedded Lua version
[[tool.bumpversion.files]]
filename = "bindings/nodejs/lua/luma/version.lua"
search = "major = {current_major}"
replace = "major = {new_major}"

[[tool.bumpversion.files]]
filename = "bindings/nodejs/lua/luma/version.lua"
search = "minor = {current_minor}"
replace = "minor = {new_minor}"

[[tool.bumpversion.files]]
filename = "bindings/nodejs/lua/luma/version.lua"
search = "patch = {current_patch}"
replace = "patch = {new_patch}"

[[tool.bumpversion.files]]
filename = "bindings/nodejs/lua/luma/version.lua"
search = "pre = \"{current_pre}.{current_pre_n}\""
replace = "pre = \"{new_pre}.{new_pre_n}\""
regex = false

# Helm plugin
[[tool.bumpversion.files]]
filename = "integrations/helm/plugin.yaml"
search = "version: \"{current_version}\""
replace = "version: \"{new_version}\""

# VSCode extension
[[tool.bumpversion.files]]
filename = "tools/vscode-luma/package.json"
search = "\"version\": \"{current_version}\""
replace = "\"version\": \"{new_version}\""

# WASM build
[[tool.bumpversion.files]]
filename = "dist/wasm/package.json"
search = "\"version\": \"{current_version}\""
replace = "\"version\": \"{new_version}\""

# Note: package-lock.json is auto-generated by npm, no need to version bump it

# Documentation
# Note: ECOSYSTEM.md is updated manually before stable releases

# Docker build script
[[tool.bumpversion.files]]
filename = "dist/docker/build.sh"
search = "VERSION=\"${{1:-{current_version}}}\""
replace = "VERSION=\"${{1:-{new_version}}}\""

# Note: Dockerfile uses ARG VERSION passed at build time, not hardcoded

# LuaRocks rockspec - generated during release workflow
# The rockspec is dynamically created with correct version and git tag
# No need to version control the rockspec file
