[tool.bumpversion]
current_version = "0.1.0"
parse = "(?P<major>\\d+)\\.(?P<minor>\\d+)\\.(?P<patch>\\d+)(\\-(?P<pre_l>[a-z]+)(\\.(?P<pre_n>\\d+))?)?"
serialize = [
    "{major}.{minor}.{patch}-{pre_l}.{pre_n}",
    "{major}.{minor}.{patch}-{pre_l}",
    "{major}.{minor}.{patch}"
]
search = "{current_version}"
replace = "{new_version}"
regex = false
ignore_missing_version = false
tag = true
sign_tags = false
tag_name = "v{new_version}"
tag_message = "Bump version: {current_version} → {new_version}"
allow_dirty = false
commit = true
message = "chore: bump version {current_version} → {new_version}"
commit_args = "--signoff --no-gpg-sign"

[tool.bumpversion.parts.pre_l]
optional_value = "final"
values = [
    "alpha",
    "beta",
    "rc",
    "final"
]

[tool.bumpversion.parts.pre_n]
optional_value = "0"

# Core Lua version file
[[tool.bumpversion.files]]
filename = "luma/version.lua"
search = "major = {current_major}"
replace = "major = {new_major}"

[[tool.bumpversion.files]]
filename = "luma/version.lua"
search = "minor = {current_minor}"
replace = "minor = {new_minor}"

[[tool.bumpversion.files]]
filename = "luma/version.lua"
search = "patch = {current_patch}"
replace = "patch = {new_patch}"

[[tool.bumpversion.files]]
filename = "luma/version.lua"
regex = true
search = "pre = (nil|\"[^\"]*\")"
replace = "pre = {new_pre_lua}"

# Python bindings
[[tool.bumpversion.files]]
filename = "bindings/python/pyproject.toml"
search = "version = \"{current_version}\""
replace = "version = \"{new_version}\""

[[tool.bumpversion.files]]
filename = "bindings/python/luma/__init__.py"
search = "__version__ = \"{current_version}\""
replace = "__version__ = \"{new_version}\""

# Node.js bindings
[[tool.bumpversion.files]]
filename = "bindings/nodejs/package.json"
search = "\"version\": \"{current_version}\""
replace = "\"version\": \"{new_version}\""

# Go bindings - embedded Lua version
[[tool.bumpversion.files]]
filename = "bindings/go/lua/luma/version.lua"
search = "major = {current_major}"
replace = "major = {new_major}"

[[tool.bumpversion.files]]
filename = "bindings/go/lua/luma/version.lua"
search = "minor = {current_minor}"
replace = "minor = {new_minor}"

[[tool.bumpversion.files]]
filename = "bindings/go/lua/luma/version.lua"
search = "patch = {current_patch}"
replace = "patch = {new_patch}"

[[tool.bumpversion.files]]
filename = "bindings/go/lua/luma/version.lua"
regex = true
search = "pre = (nil|\"[^\"]*\")"
replace = "pre = {new_pre_lua}"

# Node.js bindings - embedded Lua version
[[tool.bumpversion.files]]
filename = "bindings/nodejs/lua/luma/version.lua"
search = "major = {current_major}"
replace = "major = {new_major}"

[[tool.bumpversion.files]]
filename = "bindings/nodejs/lua/luma/version.lua"
search = "minor = {current_minor}"
replace = "minor = {new_minor}"

[[tool.bumpversion.files]]
filename = "bindings/nodejs/lua/luma/version.lua"
search = "patch = {current_patch}"
replace = "patch = {new_patch}"

[[tool.bumpversion.files]]
filename = "bindings/nodejs/lua/luma/version.lua"
regex = true
search = "pre = (nil|\"[^\"]*\")"
replace = "pre = {new_pre_lua}"

# Helm plugin
[[tool.bumpversion.files]]
filename = "integrations/helm/plugin.yaml"
search = "version: \"{current_version}\""
replace = "version: \"{new_version}\""

# VSCode extension
[[tool.bumpversion.files]]
filename = "tools/vscode-luma/package.json"
search = "\"version\": \"{current_version}\""
replace = "\"version\": \"{new_version}\""

# WASM build
[[tool.bumpversion.files]]
filename = "dist/wasm/package.json"
search = "\"version\": \"{current_version}\""
replace = "\"version\": \"{new_version}\""

# Docker
[[tool.bumpversion.files]]
filename = "dist/docker/Dockerfile"
search = "LABEL version=\"{current_version}\""
replace = "LABEL version=\"{new_version}\""

[[tool.bumpversion.files]]
filename = "dist/docker/build.sh"
search = "VERSION=\"${{1:-{current_version}}}\""
replace = "VERSION=\"${{1:-{new_version}}}\""

# LuaRocks rockspec - handled separately due to -1 suffix
# Use: bump-my-version bump <part> && mv luma-{old}-1.rockspec luma-{new}-1.rockspec
# Then update version and tag fields in the rockspec manually

# Custom pre_lua serialization for Lua files
[tool.bumpversion.parts.pre_lua]
values = [
    "nil",
    "\"alpha\"",
    "\"beta\"",
    "\"rc\""
]
